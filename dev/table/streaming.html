<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.4-SNAPSHOT Documentation: Streaming Concepts</title>
    <link rel="shortcut icon" href="//ci.apache.org/projects/flink/flink-docs-release-1.4/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="//ci.apache.org/projects/flink/flink-docs-release-1.4/page/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.4/page/css/flink.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.4/page/css/syntax.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.4/page/css/codetabs.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-release-1.4/page/font-awesome/css/font-awesome.min.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    

    <!-- Main content. -->
    <div class="container">
      
      <div class="row">
        <div class="col-lg-3" id="sidenavcol">
          







  
    
    
    
      
    
  

  
    
    
    
      
    
  

  
    
    
    
      









  





<div class="sidenav-logo">
  <p><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4"><img class="bottom" alt="Apache Flink" src="//ci.apache.org/projects/flink/flink-docs-release-1.4/page/img/navbar-brand-logo.jpg"></a> v1.4-SNAPSHOT</p>
</div>
<ul id="sidenav">

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/index.html"><i class="fa fa-home title" aria-hidden="true"></i> Home</a></li>
    
  

  
    

    
      
    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-2" data-toggle="collapse"><i class="fa fa-map-o title appetizer" aria-hidden="true"></i> Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-2"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/concepts/programming-model.html">Programming Model</a></li>
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/concepts/runtime.html">Distributed Runtime</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/quickstart/setup_quickstart.html"><i class="fa fa-power-off title appetizer" aria-hidden="true"></i> Quickstart</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-7" data-toggle="collapse"><i class="fa fa-file-code-o title appetizer" aria-hidden="true"></i> Examples <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-7"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/examples/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/quickstart/run_example_quickstart.html">Monitoring Wikipedia Edits</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/batch/examples.html">Batch Examples</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-11" data-toggle="collapse"><i class="fa fa-book title appetizer" aria-hidden="true"></i> Cookbook <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-11"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/cookbook/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/cookbook/stream-enrichment-join.html">Stream Enrichment Join</a></li>
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/cookbook/pattern-detection.html">Pattern Detection with CEP</a></li>
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-15" data-toggle="collapse"><i class="fa fa-cogs title maindish" aria-hidden="true"></i> Project Setup <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-15"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/quickstart/java_api_quickstart.html">Sample Project in Java</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/quickstart/scala_api_quickstart.html">Sample Project in Scala</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/linking_with_flink.html">Linking with Flink</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/internals/ide_setup.html">IDE Setup</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/scala_shell.html">Scala REPL</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/linking.html">Linking with Optional Modules</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/start/flink_on_windows.html">Running Flink on Windows</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/start/building.html">Building Flink from Source</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-25" data-toggle="collapse" class="active"><i class="fa fa-code title maindish" aria-hidden="true"></i> Application Development</a><div class="collapse in" id="collapse-25"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-26" data-toggle="collapse">Basic API Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-26"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/api_concepts.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/scala_api_extensions.html">Scala API Extensions</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/java8.html">Java 8</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-30" data-toggle="collapse">Streaming (DataStream API) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-30"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/datastream_api.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-31" data-toggle="collapse">Event Time <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-31"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/event_time.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/event_timestamps_watermarks.html">Generating Timestamps / Watermarks</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/event_timestamp_extractors.html">Pre-defined Timestamp Extractors / Watermark Emitters</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-35" data-toggle="collapse">State & Fault Tolerance <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-35"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/stream/state/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/stream/state/state.html">Working with State</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/stream/state/checkpointing.html">Checkpointing</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/stream/state/queryable_state.html">Queryable State</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/stream/state/state_backends.html">State Backends</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/stream/state/custom_serialization.html">Custom Serialization</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-42" data-toggle="collapse">Operators <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-42"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/stream/operators/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/stream/operators/windows.html">Windows</a></li>
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/stream/operators/process_function.html">Process Function</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/stream/operators/asyncio.html">Async I/O</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-47" data-toggle="collapse">Connectors <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-47"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/connectors/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/connectors/guarantees.html">Fault Tolerance Guarantees</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/connectors/kafka.html">Kafka</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/connectors/cassandra.html">Cassandra</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/connectors/kinesis.html">Kinesis</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/connectors/elasticsearch.html">Elasticsearch</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/connectors/filesystem_sink.html">Rolling File Sink</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/connectors/rabbitmq.html">RabbitMQ</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/connectors/nifi.html">NiFi</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/connectors/twitter.html">Twitter</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/stream/side_output.html">Side Outputs</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/stream/testing.html">Testing</a></li>
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-61" data-toggle="collapse">Batch (DataSet API) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-61"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/batch/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/batch/dataset_transformations.html">Transformations</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/batch/iterations.html">Iterations</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/batch/zip_elements_guide.html">Zipping Elements</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/batch/fault_tolerance.html">Fault Tolerance</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/batch/python.html">Python API</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/batch/connectors.html">Connectors</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/batch/hadoop_compatibility.html">Hadoop Compatibility</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/local_execution.html">Local Execution</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/cluster_execution.html">Cluster Execution</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-72" data-toggle="collapse" class="active">Table API & SQL</a><div class="collapse in" id="collapse-72"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/table/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/table/common.html">Concepts & Common API</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/table/streaming.html" class="active">Streaming Concepts</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/table/tableApi.html">Table API</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/table/sql.html">SQL</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/table/sourceSinks.html">Table Sources & Sinks</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/table/udfs.html">User-defined Functions</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-80" data-toggle="collapse">Data Types & Serialization <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-80"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/types_serialization.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/custom_serializers.html">Custom Serializers</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-83" data-toggle="collapse">Managing Execution <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-83"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/execution_configuration.html">Execution Configuration</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/packaging.html">Program Packaging</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/parallel.html">Parallel Execution</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/execution_plans.html">Execution Plans</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/restart_strategies.html">Restart Strategies</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-90" data-toggle="collapse">Libraries <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-90"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/cep.html">Event Processing (CEP)</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/storm_compatibility.html">Storm Compatibility</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-93" data-toggle="collapse">Graphs: Gelly <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-93"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/gelly/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/gelly/graph_api.html">Graph API</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/gelly/iterative_graph_processing.html">Iterative Graph Processing</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/gelly/library_methods.html">Library Methods</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/gelly/graph_algorithms.html">Graph Algorithms</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/gelly/graph_generators.html">Graph Generators</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/gelly/bipartite_graph.html">Bipartite Graph</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-101" data-toggle="collapse">Machine Learning <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-101"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/ml/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/ml/quickstart.html">Quickstart</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/ml/multiple_linear_regression.html">Multiple Linear Regression</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/ml/cross_validation.html">Cross Validation</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/ml/distance_metrics.html">Distance Metrics</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/ml/knn.html">k-Nearest Neighbors Join</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/ml/min_max_scaler.html">MinMax Scaler</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/ml/contribution_guide.html">How to Contribute</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/ml/pipelines.html">Pipelines</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/ml/polynomial_features.html">Polynomial Features</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/ml/als.html">ALS</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/ml/sos.html">Stochastic Outlier Selection</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/ml/standard_scaler.html">Standard Scaler</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/libs/ml/svm.html">SVM using CoCoA</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/best_practices.html">Best Practices</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/migration.html">API Migration Guides</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-120" data-toggle="collapse"><i class="fa fa-sliders title maindish" aria-hidden="true"></i> Deployment & Operations <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-120"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-121" data-toggle="collapse">Clusters & Deployment <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-121"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/deployment/cluster_setup.html">Standalone Cluster</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/deployment/yarn_setup.html">YARN</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/deployment/mesos.html">Mesos</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/deployment/docker.html">Docker</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/deployment/kubernetes.html">Kubernetes</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/deployment/aws.html">AWS</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/deployment/gce_setup.html">Google Compute Engine</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/deployment/mapr_setup.html">MapR</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/jobmanager_high_availability.html">High Availability (HA)</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-132" data-toggle="collapse">State & Fault Tolerance <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-132"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/state/checkpoints.html">Checkpoints</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/state/savepoints.html">Savepoints</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/state/state_backends.html">State Backends</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/state/large_state_tuning.html">Tuning Checkpoints and Large State</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/config.html">Configuration</a></li>
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/production_ready.html">Production Readiness Checklist</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/cli.html">CLI</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/security-kerberos.html">Kerberos</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/security-ssl.html">SSL Setup</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/ops/upgrading.html">Upgrading Applications and Flink Versions</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-145" data-toggle="collapse"><i class="fa fa-bug title maindish" aria-hidden="true"></i> Debugging & Monitoring <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-145"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/monitoring/metrics.html">Metrics</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/monitoring/logging.html">Logging</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/monitoring/historyserver.html">History Server</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/monitoring/checkpoint_monitoring.html">Monitoring Checkpointing</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/monitoring/back_pressure.html">Monitoring Back Pressure</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/monitoring/rest_api.html">Monitoring REST API</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/monitoring/debugging_event_time.html">Debugging Windows & Event Time</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/monitoring/debugging_classloading.html">Debugging Classloading</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/monitoring/application_profiling.html">Application Profiling</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-156" data-toggle="collapse"><i class="fa fa-book title dessert" aria-hidden="true"></i> Internals <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-156"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/internals/components.html">Component Stack</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/internals/stream_checkpointing.html">Fault Tolerance for Data Streaming</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/internals/job_scheduling.html">Jobs and Scheduling</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/internals/task_lifecycle.html">Task Lifecycle</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/internals/filesystems.html">File Systems</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
  <li class="divider"></li>
  <li><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.4/api/java"><i class="fa fa-external-link title" aria-hidden="true"></i> Javadocs</a></li>
  <li><a href="http://flink.apache.org"><i class="fa fa-external-link title" aria-hidden="true"></i> Project Page</a></li>
</ul>

<div class="sidenav-search-box">
  <form class="navbar-form" role="search" action="//ci.apache.org/projects/flink/flink-docs-release-1.4/search-results.html">
    <div class="form-group">
      <input type="text" class="form-control" size="16px" name="q" placeholder="Search">
    </div>
    <button type="submit" class="btn btn-default">Go</button>
  </form>
</div>

<div class="sidenav-versions">
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">Pick Docs Version
    <span class="caret"></span></button>
    <ul class="dropdown-menu">
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.3">v1.3</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.2">v1.2</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.1">v1.1</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.0">v1.0</a></li>
      
    </ul>
  </div>
</div>

        </div>
        <div class="col-lg-9 content" id="contentcol">
          

          





  
  
    
    
      
    
  

  
  
    
    
      
    
  

  
  
    
    
      



<ol class="breadcrumb">

  
  
    <li><i class="fa fa-code title maindish" aria-hidden="true"></i> Application Development</li>
  

  
  
    <li><a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/table/index.html">Table API & SQL</a></li>
  

  
  
    <li class="active">Streaming Concepts</li>
  

</ol>

<h1>Streaming Concepts</h1>




<p>Flink’s <a href="tableApi.html">Table API</a> and <a href="sql.html">SQL support</a> are unified APIs for batch and stream processing. This means that Table API and SQL queries have the same semantics regardless whether their input is bounded batch input or unbounded stream input. Because the relational algebra and SQL were originally designed for batch processing, relational queries on unbounded streaming input are not as well understood as relational queries on bounded batch input.</p>

<p>On this page, we explain concepts, practical limitations, and stream-specific configuration parameters of Flink’s relational APIs on streaming data.</p>

<ul id="markdown-toc">
  <li><a href="#relational-queries-on-data-streams" id="markdown-toc-relational-queries-on-data-streams">Relational Queries on Data Streams</a></li>
  <li><a href="#dynamic-tables-amp-continuous-queries" id="markdown-toc-dynamic-tables-amp-continuous-queries">Dynamic Tables &amp; Continuous Queries</a>    <ul>
      <li><a href="#defining-a-table-on-a-stream" id="markdown-toc-defining-a-table-on-a-stream">Defining a Table on a Stream</a></li>
      <li><a href="#continuous-queries" id="markdown-toc-continuous-queries">Continuous Queries</a></li>
      <li><a href="#table-to-stream-conversion" id="markdown-toc-table-to-stream-conversion">Table to Stream Conversion</a></li>
    </ul>
  </li>
  <li><a href="#time-attributes" id="markdown-toc-time-attributes">Time Attributes</a>    <ul>
      <li><a href="#processing-time" id="markdown-toc-processing-time">Processing time</a></li>
      <li><a href="#event-time" id="markdown-toc-event-time">Event time</a></li>
    </ul>
  </li>
  <li><a href="#query-configuration" id="markdown-toc-query-configuration">Query Configuration</a>    <ul>
      <li><a href="#idle-state-retention-time" id="markdown-toc-idle-state-retention-time">Idle State Retention Time</a></li>
    </ul>
  </li>
</ul>

<h2 id="relational-queries-on-data-streams">Relational Queries on Data Streams</h2>

<p>SQL and the relational algebra have not been designed with streaming data in mind. As a consequence, there are few conceptual gaps between relational algebra (and SQL) and stream processing.</p>

<table class="table table-bordered">
	<tr>
		<th>Relational Algebra / SQL</th>
		<th>Stream Processing</th>
	</tr>
	<tr>
		<td>Relations (or tables) are bounded (multi-)sets of tuples.</td>
		<td>A stream is an infinite sequences of tuples.</td>
	</tr>
	<tr>
		<td>A query that is executed on batch data (e.g., a table in a relational database) has access to the complete input data.</td>
		<td>A streaming query cannot access all data when is started and has to "wait" for data to be streamed in.</td>
	</tr>
	<tr>
		<td>A batch query terminates after it produced a fixed sized result.</td>
		<td>A streaming query continuously updates its result based on the received records and never completes.</td>
	</tr>
</table>

<p>Despite these differences, processing streams with relational queries and SQL is not impossible. Advanced relational database systems offer a feature called <em>Materialized Views</em>. A materialized view is defined as a SQL query, just like a regular virtual view. In contrast to a virtual view, a materialized view caches the result of the query such that the query does not need to be evaluated when the view is accessed. A common challenge for caching is to prevent a cache from serving outdated results. A materialized view becomes outdated when the base tables of its definition query are modified. <em>Eager View Maintenance</em> is a technique to update materialized views and updates a materialized view as soon as its base tables are updated.</p>

<p>The connection between eager view maintenance and SQL queries on streams becomes obvious if we consider the following:</p>

<ul>
  <li>A database table is the result of a <em>stream</em> of <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code> DML statements, often called <em>changelog stream</em>.</li>
  <li>A materialized view is defined as a SQL query. In order to update the view, the query is continuously processes the changelog streams of the view’s base relations.</li>
  <li>The materialized view is the result of the streaming SQL query.</li>
</ul>

<p>With these points in mind, we introduce Flink’s concept of <em>Dynamic Tables</em> in the next section.</p>

<h2 id="dynamic-tables-amp-continuous-queries">Dynamic Tables &amp; Continuous Queries</h2>

<p><em>Dynamic tables</em> are the core concept of Flink’s Table API and SQL support for streaming data. In contrast to the static tables that represent batch data, dynamic table are changing over time. They can be queried like static batch tables. Querying a dynamic table yields a <em>Continuous Query</em>. A continuous query never terminates and produces a dynamic table as result. The query continuously updates its (dynamic) result table to reflect the changes on its input (dynamic) table. Essentially, a continuous query on a dynamic table is very similar to the definition query of a materialized view.</p>

<p>It is important to note that the result of a continuous query is always semantically equivalent to the result of the same query being executed in batch mode on a snapshot of the input tables.</p>

<p>The following figure visualizes the relationship of streams, dynamic tables, and  continuous queries:</p>

<center>
<img alt="Dynamic tables" src="//ci.apache.org/projects/flink/flink-docs-release-1.4/fig/table-streaming/stream-query-stream.png" width="80%" />
</center>

<ol>
  <li>A stream is converted into a dynamic table.</li>
  <li>A continuous query is evaluated on the dynamic table yielding a new dynamic table.</li>
  <li>The resulting dynamic table is converted back into a stream.</li>
</ol>

<p><strong>Note:</strong> Dynamic tables are foremost a logical concept. Dynamic tables are not necessarily (fully) materialized during query execution.</p>

<p>In the following, we will explain the concepts of dynamic tables and continuous queries with a stream of click events that have the following schema:</p>

<div class="highlight"><pre><code>[ 
  user:  VARCHAR,   // the name of the user
  cTime: TIMESTAMP, // the time when the URL was accessed
  url:   VARCHAR    // the URL that was accessed by the user
]
</code></pre></div>

<h3 id="defining-a-table-on-a-stream">Defining a Table on a Stream</h3>

<p>In order to process a stream with a relational query, it has to be converted into a <code>Table</code>. Conceptually, each record of the stream is interpreted as an <code>INSERT</code> modification on the resulting table. Essentially, we are building a table from an <code>INSERT</code>-only changelog stream.</p>

<p>The following figure visualizes how the stream of click event (left-hand side) is converted into a table (right-hand side). The resulting table is continuously growing as more records of the click stream are inserted.</p>

<center>
<img alt="Append mode" src="//ci.apache.org/projects/flink/flink-docs-release-1.4/fig/table-streaming/append-mode.png" width="60%" />
</center>

<p><strong>Note:</strong> A table which is defined on a stream is internally not materialized.</p>

<h3 id="continuous-queries">Continuous Queries</h3>

<p>A continuous query is evaluated on a dynamic table and produces a new dynamic table as result. In contrast to a batch query, a continuous query never terminates and updates its result table according to the updates on its input tables. At any point in time, the result of a continuous query is semantically equivalent to the result of the same query being executed in batch mode on a snapshot of the input tables.</p>

<p>In the following we show two example queries on a <code>clicks</code> table that is defined on the stream of click events.</p>

<p>The first query is a simple <code>GROUP-BY COUNT</code> aggregation query. It groups the <code>clicks</code> table on the <code>user</code> field and counts the number of visited URLs. The following figure shows how the query is evaluated over time as the <code>clicks</code> table is updated with additional rows.</p>

<center>
<img alt="Continuous Non-Windowed Query" src="//ci.apache.org/projects/flink/flink-docs-release-1.4/fig/table-streaming/query-groupBy-cnt.png" width="90%" />
</center>

<p>When the query is started, the <code>clicks</code> table (left-hand side) is empty. The query starts to compute the result table, when the first row is inserted into the <code>clicks</code> table. After the first row <code>[Mary, ./home]</code> was inserted, the result table (right-hand side, top) consists of a single row <code>[Mary, 1]</code>. When the second row <code>[Bob, ./cart]</code> is inserted into the <code>clicks</code> table, the query updates the result table and inserts a new row <code>[Bob, 1]</code>. The third row <code>[Mary, ./prod?id=1]</code> yields an update of an already computed result row such that <code>[Mary, 1]</code> is updated to <code>[Mary, 2]</code>. Finally, the query inserts a third row <code>[Liz, 1]</code> into the result table, when the fourth row is appended to the <code>clicks</code> table.</p>

<p>The second query is similar to the first one but groups the <code>clicks</code> table in addition to the <code>user</code> attribute also on an <a href="./sql.html#group-windows">hourly tumbling window</a> before it counts the number of URLs (time-based computations such as windows are based on special <a href="#time-attributes">time attributes</a>, which are discussed below.). Again, the figure shows the input and output at different points in time to visualize the changing nature of dynamic tables.</p>

<center>
<img alt="Continuous Group-Window Query" src="//ci.apache.org/projects/flink/flink-docs-release-1.4/fig/table-streaming/query-groupBy-window-cnt.png" width="100%" />
</center>

<p>As before, the input table <code>clicks</code> is shown on the left. The query continuously computes results every hour and updates the result table. The clicks table contains four rows with timestamps (<code>cTime</code>) between <code>12:00:00</code> and <code>12:59:59</code>. The query computes two results rows from this input (one for each <code>user</code>) and appends them to the result table. For the next window between <code>13:00:00</code> and <code>13:59:59</code>, the <code>clicks</code> table contains three rows, which results in another two rows being appended to the result table. The result table is updated, as more rows are appended to <code>clicks</code> over time.</p>

<h4 id="update-and-append-queries">Update and Append Queries</h4>

<p>Although the two example queries appear to be quite similar (both compute a grouped count aggregate), they differ in one important aspect: 
- The first query updates previously emitted results, i.e., the changelog stream that defines the result table contains <code>INSERT</code> and <code>UPDATE</code> changes. 
- The second query only appends to the result table, i.e., the changelog stream of the result table only consists of <code>INSERT</code> changes.</p>

<p>Whether a query produces an append-only table or an updated table has some implications:
- Queries that produce update changes usually have to maintain more state (see the following section).
- The conversion of an append-only table into a stream is different from the conversion of an updated table (see the <a href="#table-to-stream-conversion">Table to Stream Conversion</a> section).</p>

<h4 id="query-restrictions">Query Restrictions</h4>

<p>Many, but not all, semantically valid queries can be evaluated as continuous queries on streams. Some queries are too expensive to compute, either due to the size of state that they need to maintain or because computing updates is too expensive.</p>

<ul>
  <li><strong>State Size:</strong> Continuous queries are evaluated on unbounded streams and are often supposed to run for weeks or months. Hence, the total amount of data that a continuous query processes can be very large. Queries that have to update previously emitted results need to maintain all emitted rows in order to be able to update them. For instance, the first example query needs to store the URL count for each user to be able to increase the count and sent out a new result when the input table receives a new row. If only registered users are tracked, the number of counts to maintain might not be too high. However, if non-registered users get a unique user name assigned, the number of counts to maintain would grow over time and might eventually cause the query to fail.</li>
</ul>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">user</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">clicks</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">user</span><span class="p">;</span></code></pre></div>

<ul>
  <li><strong>Computing Updates:</strong> Some queries require to recompute and update a large fraction of the emitted result rows even if only a single input record is added or updated. Clearly, such queries are not well suited to be executed as continuous queries. An example is the following query which computes for each user a <code>RANK</code> based on the time of the last click. As soon as the <code>clicks</code> table receives a new row, the <code>lastAction</code> of the user is updated and a new rank must be computed. However since two rows cannot have the same rank, all lower ranked rows need to be updated as well.</li>
</ul>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">user</span><span class="p">,</span> <span class="n">RANK</span><span class="p">()</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">lastLogin</span><span class="p">)</span> 
<span class="k">FROM</span> <span class="p">(</span>
  <span class="k">SELECT</span> <span class="k">user</span><span class="p">,</span> <span class="k">MAX</span><span class="p">(</span><span class="n">cTime</span><span class="p">)</span> <span class="k">AS</span> <span class="n">lastAction</span> <span class="k">FROM</span> <span class="n">clicks</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="k">user</span>
<span class="p">);</span></code></pre></div>

<p>The <a href="#query-configuration">QueryConfig</a> section discusses parameters to control the execution of continuous queries. Some parameters can be used to trade the size of maintained state for result accuracy.</p>

<h3 id="table-to-stream-conversion">Table to Stream Conversion</h3>

<p>A dynamic table can be continuously modified by <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code> changes just like a regular database table. It might be a table with a single row, which is constantly updated, an insert-only table without <code>UPDATE</code> and <code>DELETE</code> modifications, or anything in between.</p>

<p>When converting a dynamic table into a stream or writing it to an external system, these changes need to be encoded. Flink’s Table API and SQL support three ways to encode the changes of a dynamic table:</p>

<ul>
  <li>
    <p><strong>Append-only stream:</strong> A dynamic table that is only modified by <code>INSERT</code> changes can be  converted into a stream by emitting the inserted rows.</p>
  </li>
  <li>
    <p><strong>Retract stream:</strong> A retract stream is a stream with two types of messages, <em>add messages</em> and <em>retract messages</em>. A dynamic table is converted into an retract stream by encoding an <code>INSERT</code> change as add message, a <code>DELETE</code> change as retract message, and an <code>UPDATE</code> change as a retract message for the updated (previous) row and an add message for the updating (new) row. The following figure visualizes the conversion of a dynamic table into a retract stream.</p>
  </li>
</ul>

<center>
<img alt="Dynamic tables" src="//ci.apache.org/projects/flink/flink-docs-release-1.4/fig/table-streaming/undo-redo-mode.png" width="85%" />
</center>
<p><br /><br /></p>

<ul>
  <li><strong>Upsert stream:</strong> An upsert stream is a stream with two types of messages, <em>upsert messages</em> and <em>delete message</em>. A dynamic table that is converted into an upsert stream requires a (possibly composite) unique key. A dynamic table with unique key is converted into a dynamic table by encoding <code>INSERT</code> and <code>UPDATE</code> changes as upsert message and <code>DELETE</code> changes as delete message. The stream consuming operator needs to be aware of the unique key attribute in order to apply messages correctly. The main difference to a retract stream is that <code>UPDATE</code> changes are encoded with a single message and hence more efficient. The following figure visualizes the conversion of a dynamic table into an upsert stream.</li>
</ul>

<center>
<img alt="Dynamic tables" src="//ci.apache.org/projects/flink/flink-docs-release-1.4/fig/table-streaming/redo-mode.png" width="85%" />
</center>
<p><br /><br /></p>

<p>The API to convert a dynamic table into a <code>DataStream</code> is discussed on the <a href="./common.html#convert-a-table-into-a-datastream">Common Concepts</a> page. Please note that only append and retract streams are supported when converting a dynamic table into a <code>DataStream</code>. The <code>TableSink</code> interface to emit a dynamic table to an external system are discussed on the <a href="./sourceSinks.html#define-a-tablesink">TableSources and TableSinks</a> page.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="time-attributes">Time Attributes</h2>

<p>Flink is able to process streaming data based on different notions of <em>time</em>.</p>

<ul>
  <li><em>Processing time</em> refers to the system time of the machine (also known as “wall-clock time”) that is executing the respective operation.</li>
  <li><em>Event time</em> refers to the processing of streaming data based on timestamps which are attached to each row. The timestamps can encode when an event happened.</li>
  <li><em>Ingestion time</em> is the time that events enter Flink; internally, it is treated similarly to event time.</li>
</ul>

<p>For more information about time handling in Flink, see the introduction about <a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/event_time.html">Event Time and Watermarks</a>.</p>

<p>Table programs require that the corresponding time characteristic has been specified for the streaming environment:</p>

<div class="codetabs">
  <div data-lang="java">

    <div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">StreamExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>

<span class="n">env</span><span class="o">.</span><span class="na">setStreamTimeCharacteristic</span><span class="o">(</span><span class="n">TimeCharacteristic</span><span class="o">.</span><span class="na">ProcessingTime</span><span class="o">);</span> <span class="c1">// default</span>

<span class="c1">// alternatively:</span>
<span class="c1">// env.setStreamTimeCharacteristic(TimeCharacteristic.IngestionTime);</span>
<span class="c1">// env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);</span></code></pre></div>

  </div>
  <div data-lang="scala">

    <div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">env</span> <span class="k">=</span> <span class="nc">StreamExecutionEnvironment</span><span class="o">.</span><span class="n">getExecutionEnvironment</span>

<span class="n">env</span><span class="o">.</span><span class="n">setStreamTimeCharacteristic</span><span class="o">(</span><span class="nc">TimeCharacteristic</span><span class="o">.</span><span class="nc">ProcessingTime</span><span class="o">)</span> <span class="c1">// default</span>

<span class="c1">// alternatively:</span>
<span class="c1">// env.setStreamTimeCharacteristic(TimeCharacteristic.IngestionTime)</span>
<span class="c1">// env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)</span></code></pre></div>

  </div>
</div>

<p>Time-based operations such as windows in both the <a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/table/tableApi.html#group-windows">Table API</a> and <a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/table/sql.html#group-windows">SQL</a> require information about the notion of time and its origin. Therefore, tables can offer <em>logical time attributes</em> for indicating time and accessing corresponding timestamps in table programs.</p>

<p>Time attributes can be part of every table schema. They are defined when creating a table from a <code>DataStream</code> or are pre-defined when using a <code>TableSource</code>. Once a time attribute has been defined at the beginning, it can be referenced as a field and can used in time-based operations.</p>

<p>As long as a time attribute is not modified and is simply forwarded from one part of the query to another, it remains a valid time attribute. Time attributes behave like regular timestamps and can be accessed for calculations. If a time attribute is used in a calculation, it will be materialized and becomes a regular timestamp. Regular timestamps do not cooperate with Flink’s time and watermarking system and thus can not be used for time-based operations anymore.</p>

<h3 id="processing-time">Processing time</h3>

<p>Processing time allows a table program to produce results based on the time of the local machine. It is the simplest notion of time but does not provide determinism. It neither requires timestamp extraction nor watermark generation.</p>

<p>There are two ways to define a processing time attribute.</p>

<h4 id="during-datastream-to-table-conversion">During DataStream-to-Table Conversion</h4>

<p>The processing time attribute is defined with the <code>.proctime</code> property during schema definition. The time attribute must only extend the physical schema by an additional logical field. Thus, it can only be defined at the end of the schema definition.</p>

<div class="codetabs">
  <div data-lang="java">

    <div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="o">...;</span>

<span class="c1">// declare an additional logical field as a processing time attribute</span>
<span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="s">&quot;Username, Data, UserActionTime.proctime&quot;</span><span class="o">);</span>

<span class="n">WindowedTable</span> <span class="n">windowedTable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">window</span><span class="o">(</span><span class="n">Tumble</span><span class="o">.</span><span class="na">over</span><span class="o">(</span><span class="s">&quot;10.minutes&quot;</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="s">&quot;UserActionTime&quot;</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">&quot;userActionWindow&quot;</span><span class="o">));</span></code></pre></div>

  </div>
  <div data-lang="scala">

    <div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">stream</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">)]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// declare an additional logical field as a processing time attribute</span>
<span class="k">val</span> <span class="n">table</span> <span class="k">=</span> <span class="n">tEnv</span><span class="o">.</span><span class="n">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="-Symbol">&#39;UserActionTimestamp</span><span class="o">,</span> <span class="-Symbol">&#39;Username</span><span class="o">,</span> <span class="-Symbol">&#39;Data</span><span class="o">,</span> <span class="-Symbol">&#39;UserActionTime</span><span class="o">.</span><span class="n">proctime</span><span class="o">)</span>

<span class="k">val</span> <span class="n">windowedTable</span> <span class="k">=</span> <span class="n">table</span><span class="o">.</span><span class="n">window</span><span class="o">(</span><span class="nc">Tumble</span> <span class="n">over</span> <span class="mf">10.</span><span class="n">minutes</span> <span class="n">on</span> <span class="-Symbol">&#39;UserActionTime</span> <span class="n">as</span> <span class="-Symbol">&#39;userActionWindow</span><span class="o">)</span></code></pre></div>

  </div>
</div>

<h4 id="using-a-tablesource">Using a TableSource</h4>

<p>The processing time attribute is defined by a <code>TableSource</code> that implements the <code>DefinedProctimeAttribute</code> interface. The logical time attribute is appended to the physical schema defined by the return type of the <code>TableSource</code>.</p>

<div class="codetabs">
  <div data-lang="java">

    <div class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// define a table source with a processing attribute</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserActionSource</span> <span class="kd">implements</span> <span class="n">StreamTableSource</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;,</span> <span class="n">DefinedProctimeAttribute</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">TypeInformation</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="nf">getReturnType</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">String</span><span class="o">[]</span> <span class="n">names</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span><span class="s">&quot;Username&quot;</span> <span class="o">,</span> <span class="s">&quot;Data&quot;</span><span class="o">};</span>
		<span class="n">TypeInformation</span><span class="o">[]</span> <span class="n">types</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TypeInformation</span><span class="o">[]</span> <span class="o">{</span><span class="n">Types</span><span class="o">.</span><span class="na">STRING</span><span class="o">(),</span> <span class="n">Types</span><span class="o">.</span><span class="na">STRING</span><span class="o">()};</span>
		<span class="k">return</span> <span class="n">Types</span><span class="o">.</span><span class="na">ROW</span><span class="o">(</span><span class="n">names</span><span class="o">,</span> <span class="n">types</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="nf">getDataStream</span><span class="o">(</span><span class="n">StreamExecutionEnvironment</span> <span class="n">execEnv</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// create stream </span>
		<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="o">...;</span>
		<span class="k">return</span> <span class="n">stream</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getProctimeAttribute</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">// field with this name will be appended as a third field </span>
		<span class="k">return</span> <span class="s">&quot;UserActionTime&quot;</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// register table source</span>
<span class="n">tEnv</span><span class="o">.</span><span class="na">registerTableSource</span><span class="o">(</span><span class="s">&quot;UserActions&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">UserActionSource</span><span class="o">());</span>

<span class="n">WindowedTable</span> <span class="n">windowedTable</span> <span class="o">=</span> <span class="n">tEnv</span>
	<span class="o">.</span><span class="na">scan</span><span class="o">(</span><span class="s">&quot;UserActions&quot;</span><span class="o">)</span>
	<span class="o">.</span><span class="na">window</span><span class="o">(</span><span class="n">Tumble</span><span class="o">.</span><span class="na">over</span><span class="o">(</span><span class="s">&quot;10.minutes&quot;</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="s">&quot;UserActionTime&quot;</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">&quot;userActionWindow&quot;</span><span class="o">));</span></code></pre></div>

  </div>
  <div data-lang="scala">

    <div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// define a table source with a processing attribute</span>
<span class="k">class</span> <span class="nc">UserActionSource</span> <span class="k">extends</span> <span class="nc">StreamTableSource</span><span class="o">[</span><span class="kt">Row</span><span class="o">]</span> <span class="k">with</span> <span class="nc">DefinedProctimeAttribute</span> <span class="o">{</span>

	<span class="k">override</span> <span class="k">def</span> <span class="n">getReturnType</span> <span class="k">=</span> <span class="o">{</span>
		<span class="k">val</span> <span class="n">names</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&quot;Username&quot;</span> <span class="o">,</span> <span class="s">&quot;Data&quot;</span><span class="o">)</span>
		<span class="k">val</span> <span class="n">types</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">TypeInformation</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="nc">Types</span><span class="o">.</span><span class="nc">STRING</span><span class="o">,</span> <span class="nc">Types</span><span class="o">.</span><span class="nc">STRING</span><span class="o">)</span>
		<span class="nc">Types</span><span class="o">.</span><span class="nc">ROW</span><span class="o">(</span><span class="n">names</span><span class="o">,</span> <span class="n">types</span><span class="o">)</span>
	<span class="o">}</span>

	<span class="k">override</span> <span class="k">def</span> <span class="n">getDataStream</span><span class="o">(</span><span class="n">execEnv</span><span class="k">:</span> <span class="kt">StreamExecutionEnvironment</span><span class="o">)</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">Row</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
		<span class="c1">// create stream</span>
		<span class="k">val</span> <span class="n">stream</span> <span class="k">=</span> <span class="o">...</span>
		<span class="n">stream</span>
	<span class="o">}</span>

	<span class="k">override</span> <span class="k">def</span> <span class="n">getProctimeAttribute</span> <span class="k">=</span> <span class="o">{</span>
		<span class="c1">// field with this name will be appended as a third field </span>
		<span class="s">&quot;UserActionTime&quot;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// register table source</span>
<span class="n">tEnv</span><span class="o">.</span><span class="n">registerTableSource</span><span class="o">(</span><span class="s">&quot;UserActions&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nc">UserActionSource</span><span class="o">)</span>

<span class="k">val</span> <span class="n">windowedTable</span> <span class="k">=</span> <span class="n">tEnv</span>
	<span class="o">.</span><span class="n">scan</span><span class="o">(</span><span class="s">&quot;UserActions&quot;</span><span class="o">)</span>
	<span class="o">.</span><span class="n">window</span><span class="o">(</span><span class="nc">Tumble</span> <span class="n">over</span> <span class="mf">10.</span><span class="n">minutes</span> <span class="n">on</span> <span class="-Symbol">&#39;UserActionTime</span> <span class="n">as</span> <span class="-Symbol">&#39;userActionWindow</span><span class="o">)</span></code></pre></div>

  </div>
</div>

<h3 id="event-time">Event time</h3>

<p>Event time allows a table program to produce results based on the time that is contained in every record. This allows for consistent results even in case of out-of-order events or late events. It also ensures replayable results of the table program when reading records from persistent storage.</p>

<p>Additionally, event time allows for unified syntax for table programs in both batch and streaming environments. A time attribute in a streaming environment can be a regular field of a record in a batch environment.</p>

<p>In order to handle out-of-order events and distinguish between on-time and late events in streaming, Flink needs to extract timestamps from events and make some kind of progress in time (so-called <a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/event_time.html">watermarks</a>).</p>

<p>An event time attribute can be defined either during DataStream-to-Table conversion or by using a TableSource.</p>

<p>The Table API &amp; SQL assume that in both cases timestamps and watermarks have been generated in the <a href="//ci.apache.org/projects/flink/flink-docs-release-1.4/dev/event_timestamps_watermarks.html">underlying DataStream API</a> before. Ideally, this happens within a <code>TableSource</code> with knowledge about the incoming data’s characteristics and is hidden from the end user of the API.</p>

<h4 id="during-datastream-to-table-conversion-1">During DataStream-to-Table Conversion</h4>

<p>The event time attribute is defined with the <code>.rowtime</code> property during schema definition.</p>

<p>Timestamps and watermarks must have been assigned in the <code>DataStream</code> that is converted.</p>

<p>There are two ways of defining the time attribute when converting a <code>DataStream</code> into a <code>Table</code>:</p>

<ul>
  <li>Extending the physical schema by an additional logical field</li>
  <li>Replacing a physical field by a logical field (e.g. because it is no longer needed after timestamp extraction).</li>
</ul>

<div class="codetabs">
  <div data-lang="java">

    <div class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// Option 1:</span>

<span class="c1">// extract timestamp and assign watermarks based on knowledge of the stream</span>
<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Tuple3</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">inputStream</span><span class="o">.</span><span class="na">assignTimestampsAndWatermarks</span><span class="o">(...);</span>

<span class="c1">// declare an additional logical field as an event time attribute</span>
<span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="s">&quot;Username, Data, UserActionTime.rowtime&quot;</span><span class="o">);</span>


<span class="c1">// Option 2:</span>

<span class="c1">// extract timestamp from first field, and assign watermarks based on knowledge of the stream</span>
<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Tuple3</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">inputStream</span><span class="o">.</span><span class="na">assignTimestampsAndWatermarks</span><span class="o">(...);</span>

<span class="c1">// the first field has been used for timestamp extraction, and is no longer necessary</span>
<span class="c1">// replace first field with a logical event time attribute</span>
<span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">tEnv</span><span class="o">.</span><span class="na">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="s">&quot;UserActionTime.rowtime, Username, Data&quot;</span><span class="o">);</span>

<span class="c1">// Usage:</span>

<span class="n">WindowedTable</span> <span class="n">windowedTable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">window</span><span class="o">(</span><span class="n">Tumble</span><span class="o">.</span><span class="na">over</span><span class="o">(</span><span class="s">&quot;10.minutes&quot;</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="s">&quot;UserActionTime&quot;</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">&quot;userActionWindow&quot;</span><span class="o">));</span></code></pre></div>

  </div>
  <div data-lang="scala">

    <div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// Option 1:</span>

<span class="c1">// extract timestamp and assign watermarks based on knowledge of the stream</span>
<span class="k">val</span> <span class="n">stream</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">)]</span> <span class="k">=</span> <span class="n">inputStream</span><span class="o">.</span><span class="n">assignTimestampsAndWatermarks</span><span class="o">(...)</span>

<span class="c1">// declare an additional logical field as an event time attribute</span>
<span class="k">val</span> <span class="n">table</span> <span class="k">=</span> <span class="n">tEnv</span><span class="o">.</span><span class="n">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="-Symbol">&#39;Username</span><span class="o">,</span> <span class="-Symbol">&#39;Data</span><span class="o">,</span> <span class="-Symbol">&#39;UserActionTime</span><span class="o">.</span><span class="n">rowtime</span><span class="o">)</span>


<span class="c1">// Option 2:</span>

<span class="c1">// extract timestamp from first field, and assign watermarks based on knowledge of the stream</span>
<span class="k">val</span> <span class="n">stream</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[(</span><span class="kt">Long</span>, <span class="kt">String</span>, <span class="kt">String</span><span class="o">)]</span> <span class="k">=</span> <span class="n">inputStream</span><span class="o">.</span><span class="n">assignTimestampsAndWatermarks</span><span class="o">(...)</span>

<span class="c1">// the first field has been used for timestamp extraction, and is no longer necessary</span>
<span class="c1">// replace first field with a logical event time attribute</span>
<span class="k">val</span> <span class="n">table</span> <span class="k">=</span> <span class="n">tEnv</span><span class="o">.</span><span class="n">fromDataStream</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="-Symbol">&#39;UserActionTime</span><span class="o">.</span><span class="n">rowtime</span><span class="o">,</span> <span class="-Symbol">&#39;Username</span><span class="o">,</span> <span class="-Symbol">&#39;Data</span><span class="o">)</span>

<span class="c1">// Usage:</span>

<span class="k">val</span> <span class="n">windowedTable</span> <span class="k">=</span> <span class="n">table</span><span class="o">.</span><span class="n">window</span><span class="o">(</span><span class="nc">Tumble</span> <span class="n">over</span> <span class="mf">10.</span><span class="n">minutes</span> <span class="n">on</span> <span class="-Symbol">&#39;UserActionTime</span> <span class="n">as</span> <span class="-Symbol">&#39;userActionWindow</span><span class="o">)</span></code></pre></div>

  </div>
</div>

<h4 id="using-a-tablesource-1">Using a TableSource</h4>

<p>The event time attribute is defined by a <code>TableSource</code> that implements the <code>DefinedRowtimeAttribute</code> interface. The logical time attribute is appended to the physical schema defined by the return type of the <code>TableSource</code>.</p>

<p>Timestamps and watermarks must be assigned in the stream that is returned by the <code>getDataStream()</code> method.</p>

<div class="codetabs">
  <div data-lang="java">

    <div class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// define a table source with a rowtime attribute</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserActionSource</span> <span class="kd">implements</span> <span class="n">StreamTableSource</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;,</span> <span class="n">DefinedRowtimeAttribute</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">TypeInformation</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="nf">getReturnType</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">String</span><span class="o">[]</span> <span class="n">names</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span><span class="s">&quot;Username&quot;</span> <span class="o">,</span> <span class="s">&quot;Data&quot;</span><span class="o">};</span>
		<span class="n">TypeInformation</span><span class="o">[]</span> <span class="n">types</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TypeInformation</span><span class="o">[]</span> <span class="o">{</span><span class="n">Types</span><span class="o">.</span><span class="na">STRING</span><span class="o">(),</span> <span class="n">Types</span><span class="o">.</span><span class="na">STRING</span><span class="o">()};</span>
		<span class="k">return</span> <span class="n">Types</span><span class="o">.</span><span class="na">ROW</span><span class="o">(</span><span class="n">names</span><span class="o">,</span> <span class="n">types</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="nf">getDataStream</span><span class="o">(</span><span class="n">StreamExecutionEnvironment</span> <span class="n">execEnv</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// create stream </span>
		<span class="c1">// ...</span>
		<span class="c1">// extract timestamp and assign watermarks based on knowledge of the stream</span>
		<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">inputStream</span><span class="o">.</span><span class="na">assignTimestampsAndWatermarks</span><span class="o">(...);</span>
		<span class="k">return</span> <span class="n">stream</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getRowtimeAttribute</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">// field with this name will be appended as a third field </span>
		<span class="k">return</span> <span class="s">&quot;UserActionTime&quot;</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// register the table source</span>
<span class="n">tEnv</span><span class="o">.</span><span class="na">registerTableSource</span><span class="o">(</span><span class="s">&quot;UserActions&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">UserActionSource</span><span class="o">());</span>

<span class="n">WindowedTable</span> <span class="n">windowedTable</span> <span class="o">=</span> <span class="n">tEnv</span>
	<span class="o">.</span><span class="na">scan</span><span class="o">(</span><span class="s">&quot;UserActions&quot;</span><span class="o">)</span>
	<span class="o">.</span><span class="na">window</span><span class="o">(</span><span class="n">Tumble</span><span class="o">.</span><span class="na">over</span><span class="o">(</span><span class="s">&quot;10.minutes&quot;</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="s">&quot;UserActionTime&quot;</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="s">&quot;userActionWindow&quot;</span><span class="o">));</span></code></pre></div>

  </div>
  <div data-lang="scala">

    <div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// define a table source with a rowtime attribute</span>
<span class="k">class</span> <span class="nc">UserActionSource</span> <span class="k">extends</span> <span class="nc">StreamTableSource</span><span class="o">[</span><span class="kt">Row</span><span class="o">]</span> <span class="k">with</span> <span class="nc">DefinedRowtimeAttribute</span> <span class="o">{</span>

	<span class="k">override</span> <span class="k">def</span> <span class="n">getReturnType</span> <span class="k">=</span> <span class="o">{</span>
		<span class="k">val</span> <span class="n">names</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&quot;Username&quot;</span> <span class="o">,</span> <span class="s">&quot;Data&quot;</span><span class="o">)</span>
		<span class="k">val</span> <span class="n">types</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">TypeInformation</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="nc">Types</span><span class="o">.</span><span class="nc">STRING</span><span class="o">,</span> <span class="nc">Types</span><span class="o">.</span><span class="nc">STRING</span><span class="o">)</span>
		<span class="nc">Types</span><span class="o">.</span><span class="nc">ROW</span><span class="o">(</span><span class="n">names</span><span class="o">,</span> <span class="n">types</span><span class="o">)</span>
	<span class="o">}</span>

	<span class="k">override</span> <span class="k">def</span> <span class="n">getDataStream</span><span class="o">(</span><span class="n">execEnv</span><span class="k">:</span> <span class="kt">StreamExecutionEnvironment</span><span class="o">)</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">Row</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
		<span class="c1">// create stream </span>
		<span class="c1">// ...</span>
		<span class="c1">// extract timestamp and assign watermarks based on knowledge of the stream</span>
		<span class="k">val</span> <span class="n">stream</span> <span class="k">=</span> <span class="n">inputStream</span><span class="o">.</span><span class="n">assignTimestampsAndWatermarks</span><span class="o">(...)</span>
		<span class="n">stream</span>
	<span class="o">}</span>

	<span class="k">override</span> <span class="k">def</span> <span class="n">getRowtimeAttribute</span> <span class="k">=</span> <span class="o">{</span>
		<span class="c1">// field with this name will be appended as a third field</span>
		<span class="s">&quot;UserActionTime&quot;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// register the table source</span>
<span class="n">tEnv</span><span class="o">.</span><span class="n">registerTableSource</span><span class="o">(</span><span class="s">&quot;UserActions&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nc">UserActionSource</span><span class="o">)</span>

<span class="k">val</span> <span class="n">windowedTable</span> <span class="k">=</span> <span class="n">tEnv</span>
	<span class="o">.</span><span class="n">scan</span><span class="o">(</span><span class="s">&quot;UserActions&quot;</span><span class="o">)</span>
	<span class="o">.</span><span class="n">window</span><span class="o">(</span><span class="nc">Tumble</span> <span class="n">over</span> <span class="mf">10.</span><span class="n">minutes</span> <span class="n">on</span> <span class="-Symbol">&#39;UserActionTime</span> <span class="n">as</span> <span class="-Symbol">&#39;userActionWindow</span><span class="o">)</span></code></pre></div>

  </div>
</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="query-configuration">Query Configuration</h2>

<p>Table API and SQL queries have the same semantics regardless whether their input is bounded batch input or unbounded stream input. In many cases, continuous queries on streaming input are capable of computing accurate results that are identical to offline computed results. However, this is not possible in general case because continuous queries have to restrict the size of the state they are maintaining in order to avoid to run out of storage and to be able to process unbounded streaming data over a long period of time. As a result, a continuous query might only be able to provide approximated results depending on the characteristics of the input data and the query itself.</p>

<p>Flink’s Table API and SQL interface provide parameters to tune the accuracy and resource consumption of continuous queries. The parameters are specified via a <code>QueryConfig</code> object. The <code>QueryConfig</code> can be obtained from the <code>TableEnvironment</code> and is passed back when a <code>Table</code> is translated, i.e., when it is <a href="common.html#convert-a-table-into-a-datastream-or-dataset">transformed into a DataStream</a> or <a href="common.html#emit-a-table">emitted via a TableSink</a>.</p>

<div class="codetabs">
  <div data-lang="java">

    <div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">StreamExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>
<span class="n">StreamTableEnvironment</span> <span class="n">tableEnv</span> <span class="o">=</span> <span class="n">TableEnvironment</span><span class="o">.</span><span class="na">getTableEnvironment</span><span class="o">(</span><span class="n">env</span><span class="o">);</span>

<span class="c1">// obtain query configuration from TableEnvironment</span>
<span class="n">StreamQueryConfig</span> <span class="n">qConfig</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">queryConfig</span><span class="o">();</span>
<span class="c1">// set query parameters</span>
<span class="n">qConfig</span><span class="o">.</span><span class="na">withIdleStateRetentionTime</span><span class="o">(</span><span class="n">Time</span><span class="o">.</span><span class="na">hours</span><span class="o">(</span><span class="mi">12</span><span class="o">));</span>

<span class="c1">// define query</span>
<span class="n">Table</span> <span class="n">result</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// create TableSink</span>
<span class="n">TableSink</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">sink</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// emit result Table via a TableSink</span>
<span class="n">result</span><span class="o">.</span><span class="na">writeToSink</span><span class="o">(</span><span class="n">sink</span><span class="o">,</span> <span class="n">qConfig</span><span class="o">);</span>

<span class="c1">// convert result Table into a DataStream&lt;Row&gt;</span>
<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="na">toAppendStream</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">Row</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">qConfig</span><span class="o">);</span></code></pre></div>

  </div>
  <div data-lang="scala">

    <div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">env</span> <span class="k">=</span> <span class="nc">StreamExecutionEnvironment</span><span class="o">.</span><span class="n">getExecutionEnvironment</span>
<span class="k">val</span> <span class="n">tableEnv</span> <span class="k">=</span> <span class="nc">TableEnvironment</span><span class="o">.</span><span class="n">getTableEnvironment</span><span class="o">(</span><span class="n">env</span><span class="o">)</span>

<span class="c1">// obtain query configuration from TableEnvironment</span>
<span class="k">val</span> <span class="n">qConfig</span><span class="k">:</span> <span class="kt">StreamQueryConfig</span> <span class="o">=</span> <span class="n">tableEnv</span><span class="o">.</span><span class="n">queryConfig</span>
<span class="c1">// set query parameters</span>
<span class="n">qConfig</span><span class="o">.</span><span class="n">withIdleStateRetentionTime</span><span class="o">(</span><span class="nc">Time</span><span class="o">.</span><span class="n">hours</span><span class="o">(</span><span class="mi">12</span><span class="o">))</span>

<span class="c1">// define query</span>
<span class="k">val</span> <span class="n">result</span><span class="k">:</span> <span class="kt">Table</span> <span class="o">=</span> <span class="o">???</span>

<span class="c1">// create TableSink</span>
<span class="k">val</span> <span class="n">sink</span><span class="k">:</span> <span class="kt">TableSink</span><span class="o">[</span><span class="kt">Row</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>

<span class="c1">// emit result Table via a TableSink</span>
<span class="n">result</span><span class="o">.</span><span class="n">writeToSink</span><span class="o">(</span><span class="n">sink</span><span class="o">,</span> <span class="n">qConfig</span><span class="o">)</span>

<span class="c1">// convert result Table into a DataStream[Row]</span>
<span class="k">val</span> <span class="n">stream</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">Row</span><span class="o">]</span> <span class="k">=</span> <span class="n">result</span><span class="o">.</span><span class="n">toAppendStream</span><span class="o">[</span><span class="kt">Row</span><span class="o">](</span><span class="n">qConfig</span><span class="o">)</span></code></pre></div>

  </div>
</div>

<p>In the the following we describe the parameters of the <code>QueryConfig</code> and how they affect the accuracy and resource consumption of a query.</p>

<h3 id="idle-state-retention-time">Idle State Retention Time</h3>

<p>Many queries aggregate or join records on one or more key attributes. When such a query is executed on a stream, the continuous query needs to collect records or maintain partial results per key. If the key domain of the input stream is evolving, i.e., the active key values are changing over time, the continuous query accumulates more and more state as more and more distinct keys are observed. However, often keys become inactive after some time and their corresponding state becomes stale and useless.</p>

<p>For example the following query computes the number of clicks per session.</p>

<div class="highlight"><pre><code>SELECT sessionId, COUNT(*) FROM clicks GROUP BY sessionId;
</code></pre></div>

<p>The <code>sessionId</code> attribute is used as a grouping key and the continuous query maintains a count for each <code>sessionId</code> it observes. The <code>sessionId</code> attribute is evolving over time and <code>sessionId</code> values are only active until the session ends, i.e., for a limited period of time. However, the continuous query cannot know about this property of <code>sessionId</code> and expects that every <code>sessionId</code> value can occur at any point of time. It maintains a count for each observed <code>sessionId</code> value. Consequently, the total state size of the query is continuously growing as more and more <code>sessionId</code> values are observed.</p>

<p>The <em>Idle State Retention Time</em> parameters define for how long the state of a key is retained without being updated before it is removed. For the previous example query, the count of a <code>sessionId</code> would be removed as soon as it has not been updated for the configured period of time.</p>

<p>By removing the state of a key, the continuous query completely forgets that it has seen this key before. If a record with a key, whose state has been removed before, is processed, the record will be treated as if it was the first record with the respective key. For the example above this means that the count of a <code>sessionId</code> would start again at <code>0</code>.</p>

<p>There are two parameters to configure the idle state retention time:
- The <em>minimum idle state retention time</em> defines how long the state of an inactive key is at least kept before it is removed.
- The <em>maximum idle state retention time</em> defines how long the state of an inactive key is at most kept before it is removed.</p>

<p>The parameters are specified as follows:</p>

<div class="codetabs">
  <div data-lang="java">

    <div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">StreamQueryConfig</span> <span class="n">qConfig</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// set idle state retention time: min = 12 hour, max = 16 hours</span>
<span class="n">qConfig</span><span class="o">.</span><span class="na">withIdleStateRetentionTime</span><span class="o">(</span><span class="n">Time</span><span class="o">.</span><span class="na">hours</span><span class="o">(</span><span class="mi">12</span><span class="o">),</span> <span class="n">Time</span><span class="o">.</span><span class="na">hours</span><span class="o">(</span><span class="mi">16</span><span class="o">));</span>
<span class="c1">// set idle state retention time. min = max = 12 hours</span>
<span class="n">qConfig</span><span class="o">.</span><span class="na">withIdleStateRetentionTime</span><span class="o">(</span><span class="n">Time</span><span class="o">.</span><span class="na">hours</span><span class="o">(</span><span class="mi">12</span><span class="o">);</span></code></pre></div>

  </div>
  <div data-lang="scala">

    <div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">qConfig</span><span class="k">:</span> <span class="kt">StreamQueryConfig</span> <span class="o">=</span> <span class="o">???</span>

<span class="c1">// set idle state retention time: min = 12 hour, max = 16 hours</span>
<span class="n">qConfig</span><span class="o">.</span><span class="n">withIdleStateRetentionTime</span><span class="o">(</span><span class="nc">Time</span><span class="o">.</span><span class="n">hours</span><span class="o">(</span><span class="mi">12</span><span class="o">),</span> <span class="nc">Time</span><span class="o">.</span><span class="n">hours</span><span class="o">(</span><span class="mi">16</span><span class="o">))</span>
<span class="c1">// set idle state retention time. min = max = 12 hours</span>
<span class="n">qConfig</span><span class="o">.</span><span class="n">withIdleStateRetentionTime</span><span class="o">(</span><span class="nc">Time</span><span class="o">.</span><span class="n">hours</span><span class="o">(</span><span class="mi">12</span><span class="o">)</span></code></pre></div>

  </div>
</div>

<p>Configuring different minimum and maximum idle state retention times is more efficient because it reduces the internal book-keeping of a query for when to remove state.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>



        </div>
      </div>
    </div><!-- /.container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="//ci.apache.org/projects/flink/flink-docs-release-1.4/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!-- Disqus -->
    
  </body>
</html>
