<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.4-SNAPSHOT Documentation: Join Streams</title>
    <link rel="shortcut icon" href="/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/page/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="/page/css/flink.css">
    <link rel="stylesheet" href="/page/css/syntax.css">
    <link rel="stylesheet" href="/page/css/codetabs.css">
    <link rel="stylesheet" href="/page/font-awesome/css/font-awesome.min.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    

    <!-- Main content. -->
    <div class="container">
      
      <div class="row">
        <div class="col-lg-3" id="sidenavcol">
          







  
    
    
    
      
    
  

  
    
    
    
      









  





<div class="sidenav-logo">
  <p><a href=""><img class="bottom" alt="Apache Flink" src="/page/img/navbar-brand-logo.jpg"></a> v1.4-SNAPSHOT</p>
</div>
<ul id="sidenav">

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/index.html"><i class="fa fa-home title" aria-hidden="true"></i> Home</a></li>
    
  

  
    

    
      
    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-2" data-toggle="collapse"><i class="fa fa-map-o title appetizer" aria-hidden="true"></i> Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-2"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="/concepts/programming-model.html">Programming Model</a></li>
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/concepts/runtime.html">Distributed Runtime</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/quickstart/setup_quickstart.html"><i class="fa fa-power-off title appetizer" aria-hidden="true"></i> Quickstart</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-7" data-toggle="collapse"><i class="fa fa-file-code-o title appetizer" aria-hidden="true"></i> Examples <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-7"><ul>
  <li><a href="/examples/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/quickstart/run_example_quickstart.html">Monitoring Wikipedia Edits</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/batch/examples.html">Batch Examples</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-11" data-toggle="collapse" class="active"><i class="fa fa-book title appetizer" aria-hidden="true"></i> Cookbooks</a><div class="collapse in" id="collapse-11"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="/cookbooks/join-streams.html" class="active">Join Streams</a></li>
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="/cookbooks/pattern-detection.html">Pattern Detection with CEP</a></li>
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-15" data-toggle="collapse"><i class="fa fa-cogs title maindish" aria-hidden="true"></i> Project Setup <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-15"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/quickstart/java_api_quickstart.html">Sample Project in Java</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/quickstart/scala_api_quickstart.html">Sample Project in Scala</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/linking_with_flink.html">Linking with Flink</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/internals/ide_setup.html">IDE Setup</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/scala_shell.html">Scala REPL</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/linking.html">Linking with Optional Modules</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/start/flink_on_windows.html">Running Flink on Windows</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/start/building.html">Building Flink from Source</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-25" data-toggle="collapse"><i class="fa fa-code title maindish" aria-hidden="true"></i> Application Development <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-25"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-26" data-toggle="collapse">Basic API Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-26"><ul>
  <li><a href="/dev/api_concepts.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/scala_api_extensions.html">Scala API Extensions</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/java8.html">Java 8</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-30" data-toggle="collapse">Streaming (DataStream API) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-30"><ul>
  <li><a href="/dev/datastream_api.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-31" data-toggle="collapse">Event Time <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-31"><ul>
  <li><a href="/dev/event_time.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/event_timestamps_watermarks.html">Generating Timestamps / Watermarks</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/event_timestamp_extractors.html">Pre-defined Timestamp Extractors / Watermark Emitters</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-35" data-toggle="collapse">State & Fault Tolerance <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-35"><ul>
  <li><a href="/dev/stream/state/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/stream/state/state.html">Working with State</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/stream/state/checkpointing.html">Checkpointing</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/stream/state/queryable_state.html">Queryable State</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/stream/state/state_backends.html">State Backends</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/stream/state/custom_serialization.html">Custom Serialization</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-42" data-toggle="collapse">Operators <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-42"><ul>
  <li><a href="/dev/stream/operators/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="/dev/stream/operators/windows.html">Windows</a></li>
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/stream/operators/process_function.html">Process Function</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/stream/operators/asyncio.html">Async I/O</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-47" data-toggle="collapse">Connectors <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-47"><ul>
  <li><a href="/dev/connectors/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/connectors/guarantees.html">Fault Tolerance Guarantees</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/connectors/kafka.html">Kafka</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/connectors/cassandra.html">Cassandra</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/connectors/kinesis.html">Kinesis</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/connectors/elasticsearch.html">Elasticsearch</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/connectors/filesystem_sink.html">Rolling File Sink</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/connectors/rabbitmq.html">RabbitMQ</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/connectors/nifi.html">NiFi</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/connectors/twitter.html">Twitter</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/stream/side_output.html">Side Outputs</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="/dev/stream/testing.html">Testing</a></li>
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-61" data-toggle="collapse">Batch (DataSet API) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-61"><ul>
  <li><a href="/dev/batch/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/batch/dataset_transformations.html">Transformations</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/batch/iterations.html">Iterations</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/batch/zip_elements_guide.html">Zipping Elements</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/batch/fault_tolerance.html">Fault Tolerance</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/batch/python.html">Python API</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/batch/connectors.html">Connectors</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/batch/hadoop_compatibility.html">Hadoop Compatibility</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/local_execution.html">Local Execution</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/cluster_execution.html">Cluster Execution</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-72" data-toggle="collapse">Table API & SQL <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-72"><ul>
  <li><a href="/dev/table/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/table/common.html">Concepts & Common API</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/table/streaming.html">Streaming Concepts</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/table/tableApi.html">Table API</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/table/sql.html">SQL</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/table/sourceSinks.html">Table Sources & Sinks</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/table/udfs.html">User-defined Functions</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-80" data-toggle="collapse">Data Types & Serialization <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-80"><ul>
  <li><a href="/dev/types_serialization.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/custom_serializers.html">Custom Serializers</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-83" data-toggle="collapse">Managing Execution <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-83"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/execution_configuration.html">Execution Configuration</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/packaging.html">Program Packaging</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/parallel.html">Parallel Execution</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/execution_plans.html">Execution Plans</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/restart_strategies.html">Restart Strategies</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-90" data-toggle="collapse">Libraries <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-90"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/cep.html">Event Processing (CEP)</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/storm_compatibility.html">Storm Compatibility</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-93" data-toggle="collapse">Graphs: Gelly <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-93"><ul>
  <li><a href="/dev/libs/gelly/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/gelly/graph_api.html">Graph API</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/gelly/iterative_graph_processing.html">Iterative Graph Processing</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/gelly/library_methods.html">Library Methods</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/gelly/graph_algorithms.html">Graph Algorithms</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/gelly/graph_generators.html">Graph Generators</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/gelly/bipartite_graph.html">Bipartite Graph</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-101" data-toggle="collapse">Machine Learning <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-101"><ul>
  <li><a href="/dev/libs/ml/index.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/quickstart.html">Quickstart</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/multiple_linear_regression.html">Multiple Linear Regression</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/cross_validation.html">Cross Validation</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/distance_metrics.html">Distance Metrics</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/knn.html">k-Nearest Neighbors Join</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/min_max_scaler.html">MinMax Scaler</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/contribution_guide.html">How to Contribute</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/pipelines.html">Pipelines</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/polynomial_features.html">Polynomial Features</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/als.html">ALS</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/sos.html">Stochastic Outlier Selection</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/standard_scaler.html">Standard Scaler</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/svm.html">SVM using CoCoA</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/best_practices.html">Best Practices</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/dev/migration.html">API Migration Guides</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-120" data-toggle="collapse"><i class="fa fa-sliders title maindish" aria-hidden="true"></i> Deployment & Operations <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-120"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-121" data-toggle="collapse">Clusters & Deployment <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-121"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/deployment/cluster_setup.html">Standalone Cluster</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/deployment/yarn_setup.html">YARN</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/deployment/mesos.html">Mesos</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/deployment/docker.html">Docker</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/deployment/kubernetes.html">Kubernetes</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/deployment/aws.html">AWS</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/deployment/gce_setup.html">Google Compute Engine</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/deployment/mapr_setup.html">MapR</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/jobmanager_high_availability.html">High Availability (HA)</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-132" data-toggle="collapse">State & Fault Tolerance <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-132"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/state/checkpoints.html">Checkpoints</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/state/savepoints.html">Savepoints</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/state/state_backends.html">State Backends</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/state/large_state_tuning.html">Tuning Checkpoints and Large State</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
<li><a href="/ops/config.html">Configuration</a></li>
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/production_ready.html">Production Readiness Checklist</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/cli.html">CLI</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/security-kerberos.html">Kerberos</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/security-ssl.html">SSL Setup</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/ops/upgrading.html">Upgrading Applications and Flink Versions</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-145" data-toggle="collapse"><i class="fa fa-bug title maindish" aria-hidden="true"></i> Debugging & Monitoring <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-145"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/monitoring/metrics.html">Metrics</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/monitoring/logging.html">Logging</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/monitoring/historyserver.html">History Server</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/monitoring/checkpoint_monitoring.html">Monitoring Checkpointing</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/monitoring/back_pressure.html">Monitoring Back Pressure</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/monitoring/rest_api.html">Monitoring REST API</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/monitoring/debugging_event_time.html">Debugging Windows & Event Time</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/monitoring/debugging_classloading.html">Debugging Classloading</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/monitoring/application_profiling.html">Application Profiling</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    
      
    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-156" data-toggle="collapse"><i class="fa fa-book title dessert" aria-hidden="true"></i> Internals <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-156"><ul>
  
        
        
        

        
        
      
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/internals/components.html">Component Stack</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/internals/stream_checkpointing.html">Fault Tolerance for Data Streaming</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/internals/job_scheduling.html">Jobs and Scheduling</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/internals/task_lifecycle.html">Task Lifecycle</a></li>
    
  

  
    

    
      
    

    
    
    

    

    
    
<li><a href="/internals/filesystems.html">File Systems</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
  <li class="divider"></li>
  <li><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.4/api/java"><i class="fa fa-external-link title" aria-hidden="true"></i> Javadocs</a></li>
  <li><a href="http://flink.apache.org"><i class="fa fa-external-link title" aria-hidden="true"></i> Project Page</a></li>
</ul>

<div class="sidenav-search-box">
  <form class="navbar-form" role="search" action="/search-results.html">
    <div class="form-group">
      <input type="text" class="form-control" size="16px" name="q" placeholder="Search">
    </div>
    <button type="submit" class="btn btn-default">Go</button>
  </form>
</div>

<div class="sidenav-versions">
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">Pick Docs Version
    <span class="caret"></span></button>
    <ul class="dropdown-menu">
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.3">v1.3</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.2">v1.2</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.1">v1.1</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.0">v1.0</a></li>
      
    </ul>
  </div>
</div>

        </div>
        <div class="col-lg-9 content" id="contentcol">
          

          





  
  
    
    
      
    
  

  
  
    
    
      



<ol class="breadcrumb">

  
  
    <li><i class="fa fa-book title appetizer" aria-hidden="true"></i> Cookbooks</li>
  

  
  
    <li class="active">Join Streams</li>
  

</ol>

<h1>Join Streams</h1>




<ul id="markdown-toc">
  <li><a href="#problem" id="markdown-toc-problem">Problem</a></li>
  <li><a href="#use-case" id="markdown-toc-use-case">Use case</a></li>
  <li><a href="#implementation" id="markdown-toc-implementation">Implementation</a>    <ul>
      <li><a href="#connect-streams" id="markdown-toc-connect-streams">1. Connect streams</a></li>
      <li><a href="#join-streams" id="markdown-toc-join-streams">2. Join streams</a></li>
    </ul>
  </li>
  <li><a href="#full-source-code" id="markdown-toc-full-source-code">Full source code</a></li>
</ul>

<h2 id="problem">Problem</h2>

<p>Like in relational databases, we avoid duplicating data in streams to improve performances. However, we need some time to add external context to data flowing in a stream. In a relational database, we would JOIN two tables. In Flink, we join two streams based on a key to generate a stream of enriched data.</p>

<p>A common pattern is Change Data Capture (CDC). We capture data modifications pushed in a stream and save them in the state. When data flows in the second stream, we look up the state to get the related context and enrich the flowing data. This technique makes it possible to execute a lookup at very low latency in the state instead of a slow lookup in an external source like a database.</p>

<h2 id="use-case">Use case</h2>

<p>To illustrate this technique, we take the example of a company running multiple advertisement campaigns which would like to display analytics in a dashboard.</p>

<p><strong>Streams:</strong></p>

<ul>
  <li>A new <em>AdClick</em> is pushed in <em>AdClickStream</em> each time a user clicks on an ad;</li>
  <li>A new <em>AdCampaign</em> is pushed in <em>AdCampaignStream</em> each time the marketing team creates or updates an ad;</li>
  <li>A new <em>EnrichedAdClick</em> is pushed in the joined stream <em>EnrichedAdClickStream</em> for each <em>AdClick</em> flowing in <em>AdClickStream</em>. To keep things simple <em>EnrichedAdClick</em> is just an <em>AdClick</em> enriched with the <em>campaignName</em>.</li>
</ul>

<h2 id="implementation">Implementation</h2>

<h3 id="connect-streams">1. Connect streams</h3>

<p>We need to connect streams before joining them. Two streams are connected via a common key, here <em>AdCampaign.id</em> and <em>AdClick.campaignId</em>.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">DataStream</span><span class="o">&lt;</span><span class="n">EnrichedAdClick</span><span class="o">&gt;</span> <span class="n">joinedStream</span> <span class="o">=</span> <span class="n">adClicksStream</span>
                                            <span class="o">.</span><span class="na">keyBy</span><span class="o">(</span><span class="s">&quot;campaignId&quot;</span><span class="o">)</span>
                                            <span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">adCampaignStream</span><span class="o">.</span><span class="na">keyBy</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">))</span></code></pre></div>

<h3 id="join-streams">2. Join streams</h3>

<p>In our case, we want to enrich data flowing in <em>AdClickStream</em> with data flowing in <em>AdCampaignStream</em>. Therefore, we must capture <em>AdCampaign</em> changes in the state which will later be used to look up <em>AdCampaigns</em> details.</p>

<p>We apply a <a href="/dev/datastream_api.html#datastream-transformations">flatMap</a> operator using a <a href="/api/java/org/apache/flink/streaming/api/functions/co/RichCoFlatMapFunction.html">RichCoFlatMapFunction</a> on the connected streams.</p>

<h4 id="create-a-new-richcoflatmapfunction">2.1 Create a new RichCoFlatMapFunction</h4>

<p>Let’s create a new function extending RichCoFlatMapFunction. We must specific three type parameters:</p>

<ol>
  <li>the data type flowing in the first stream: <em>AdClick</em></li>
  <li>the data type flowing in the second stream: <em>AdCampaign</em></li>
  <li>the data type which will be collected by the collector and pushed downstream: <em>EnrichedAdClick</em></li>
</ol>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">StreamJoinFunction</span> <span class="kd">extends</span> <span class="n">RichCoFlatMapFunction</span><span class="o">&lt;</span><span class="n">AdClick</span><span class="o">,</span> <span class="n">AdCampaign</span><span class="o">,</span> <span class="n">EnrichedAdClick</span><span class="o">&gt;</span></code></pre></div>

<h4 id="define-the-state">2.2 Define the state</h4>

<p>We save AdCampaign information in a MapState. MapState has a structure similar to an HashMap: &lt;key, value&gt;. In our case, the key is the <em>AdCampaign.id</em> and the <em>AdCampaign</em> is stored as the value.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="n">MapState</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">AdCampaign</span><span class="o">&gt;</span> <span class="n">adCampainState</span><span class="o">;</span></code></pre></div>

<p>The state must be defined in the method <em>open</em> which we override.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="o">(</span><span class="n">Configuration</span> <span class="n">parameters</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">adCampainState</span> <span class="o">=</span> <span class="n">getRuntimeContext</span><span class="o">().</span><span class="na">getMapState</span><span class="o">(</span><span class="k">new</span> <span class="n">MapStateDescriptor</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">AdCampaign</span><span class="o">&gt;(</span>
        <span class="s">&quot;adCampaigns&quot;</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">AdCampaign</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
<span class="o">}</span></code></pre></div>

<h4 id="process-elements-from-both-streams">2.3 Process elements from both streams</h4>

<p>Two more methods must be overridden: <em>flatMap1</em> and <em>flatMap2</em>.</p>

<p><em>flatMap2</em> is executed when new elements are flowing in the second stream: <em>AdCampaignStream</em>. We only need to insert/update the <em>AdCampaign</em> in the MapState.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">flatMap2</span><span class="o">(</span><span class="n">AdCampaign</span> <span class="n">adCampaign</span><span class="o">,</span> <span class="n">Collector</span><span class="o">&lt;</span><span class="n">EnrichedAdClick</span><span class="o">&gt;</span> <span class="n">collector</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">adCampainState</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">adCampaign</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="n">adCampaign</span><span class="o">);</span>
<span class="o">}</span></code></pre></div>

<p><em>flapMap1</em> is executed when new elements flow in the first stream <em>AdClickStream</em>. For each flowing <em>AdClick</em> we read the corresponding <em>AdCampaign</em> information from the MapState and create a new <em>EnrichedAdClick</em> that we push downstream via the collector.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">flatMap1</span><span class="o">(</span><span class="n">AdClick</span> <span class="n">adClick</span><span class="o">,</span> <span class="n">Collector</span><span class="o">&lt;</span><span class="n">EnrichedAdClick</span><span class="o">&gt;</span> <span class="n">collector</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">AdCampaign</span> <span class="n">currentAdCampaign</span> <span class="o">=</span> <span class="n">adCampainState</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">adClick</span><span class="o">.</span><span class="na">campaignId</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">campaignName</span> <span class="o">=</span> <span class="o">(</span><span class="n">currentAdCampaign</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="n">currentAdCampaign</span><span class="o">.</span><span class="na">campaignName</span> <span class="o">:</span> <span class="s">&quot;Unknown campaign&quot;</span><span class="o">;</span>

    <span class="n">EnrichedAdClick</span> <span class="n">enrichedAdClick</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">EnrichedAdClick</span><span class="o">(</span><span class="n">adClick</span><span class="o">,</span> <span class="n">campaignName</span><span class="o">);</span>
    <span class="n">collector</span><span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">enrichedAdClick</span><span class="o">);</span>
<span class="o">}</span></code></pre></div>

<p>That’s it! The flatMap operator returns now a stream of <em>EnrichedAdClick</em>. You can apply other operators of the <a href="/dev/datastream_api.html">DataStreamApi</a>.</p>

<h2 id="full-source-code">Full source code</h2>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">flink</span><span class="o">.</span><span class="na">cookbook</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.flink.api.common.state.MapState</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.api.common.state.MapStateDescriptor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.configuration.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.TimeCharacteristic</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.datastream.DataStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.environment.StreamExecutionEnvironment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.functions.co.RichCoFlatMapFunction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.functions.source.SourceFunction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.watermark.Watermark</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.util.Collector</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StreamJoin</span> <span class="o">{</span>

    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">adCampaignNumber</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

        <span class="c1">// set up streaming execution environment</span>
        <span class="n">StreamExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>
        <span class="n">env</span><span class="o">.</span><span class="na">setStreamTimeCharacteristic</span><span class="o">(</span><span class="n">TimeCharacteristic</span><span class="o">.</span><span class="na">EventTime</span><span class="o">);</span>

        <span class="c1">// Simulated AdCampaign stream</span>
        <span class="n">DataStream</span><span class="o">&lt;</span><span class="n">AdCampaign</span><span class="o">&gt;</span> <span class="n">adCampaignStream</span> <span class="o">=</span> <span class="n">adCampaignSource</span><span class="o">(</span><span class="n">env</span><span class="o">);</span>

        <span class="c1">// Simulated AdClick stream</span>
        <span class="n">DataStream</span><span class="o">&lt;</span><span class="n">AdClick</span><span class="o">&gt;</span> <span class="n">adClicksStream</span> <span class="o">=</span> <span class="n">adClickSource</span><span class="o">(</span><span class="n">env</span><span class="o">);</span>

        <span class="c1">// Connect streams by keys and join them</span>
        <span class="n">DataStream</span><span class="o">&lt;</span><span class="n">EnrichedAdClick</span><span class="o">&gt;</span> <span class="n">joinedStream</span> <span class="o">=</span> <span class="n">adClicksStream</span>
                <span class="o">.</span><span class="na">keyBy</span><span class="o">(</span><span class="s">&quot;campaignId&quot;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">adCampaignStream</span><span class="o">.</span><span class="na">keyBy</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">))</span>
                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="k">new</span> <span class="nf">StreamJoinFunction</span><span class="o">());</span>

        <span class="c1">// Print the EnrichedAdClick</span>
        <span class="n">joinedStream</span><span class="o">.</span><span class="na">print</span><span class="o">();</span>

        <span class="n">env</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">&quot;Stream join&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * DataStream source generating AdCampaigns.</span>
<span class="cm">     * It generates first a series of campaigns and keep sending random updates to existing campaigns.</span>
<span class="cm">     *</span>
<span class="cm">     * @param env</span>
<span class="cm">     * @return a DataStream of AdCampaigns</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">DataStream</span><span class="o">&lt;</span><span class="n">AdCampaign</span><span class="o">&gt;</span> <span class="nf">adCampaignSource</span><span class="o">(</span><span class="n">StreamExecutionEnvironment</span> <span class="n">env</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">DataStream</span><span class="o">&lt;</span><span class="n">AdCampaign</span><span class="o">&gt;</span> <span class="n">adCampaignStream</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="na">addSource</span><span class="o">(</span><span class="k">new</span> <span class="n">SourceFunction</span><span class="o">&lt;</span><span class="n">AdCampaign</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">keepStreaming</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">SourceContext</span><span class="o">&lt;</span><span class="n">AdCampaign</span><span class="o">&gt;</span> <span class="n">sourceContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
                <span class="n">AdCampaign</span><span class="o">[]</span> <span class="n">adCampaigns</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AdCampaign</span><span class="o">[</span><span class="n">adCampaignNumber</span><span class="o">];</span>

                <span class="c1">// Generate initial AdCampaigns</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">adCampaignNumber</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

                    <span class="n">adCampaigns</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">AdCampaign</span><span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
                    <span class="n">sourceContext</span><span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">adCampaigns</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
                <span class="o">}</span>

                <span class="c1">// Push changes to existing AdCampaigns</span>
                <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Random</span><span class="o">();</span>

                <span class="k">while</span> <span class="o">(</span><span class="n">keepStreaming</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">5000</span><span class="o">));</span>
                    <span class="kt">int</span> <span class="n">campaignIndex</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">adCampaignNumber</span><span class="o">);</span>
                    <span class="n">adCampaigns</span><span class="o">[</span><span class="n">campaignIndex</span><span class="o">].</span><span class="na">updateCampaignVersion</span><span class="o">();</span>
                    <span class="n">sourceContext</span><span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">adCampaigns</span><span class="o">[</span><span class="n">campaignIndex</span><span class="o">]);</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cancel</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">keepStreaming</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="k">return</span> <span class="n">adCampaignStream</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * DataStream source generating AdClicks.</span>
<span class="cm">     *</span>
<span class="cm">     * @param env</span>
<span class="cm">     * @return DataStream of AdClicks</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">DataStream</span><span class="o">&lt;</span><span class="n">AdClick</span><span class="o">&gt;</span> <span class="nf">adClickSource</span><span class="o">(</span><span class="n">StreamExecutionEnvironment</span> <span class="n">env</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">DataStream</span><span class="o">&lt;</span><span class="n">AdClick</span><span class="o">&gt;</span> <span class="n">adClickStream</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="na">addSource</span><span class="o">(</span><span class="k">new</span> <span class="n">SourceFunction</span><span class="o">&lt;</span><span class="n">AdClick</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">keepStreaming</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">SourceContext</span><span class="o">&lt;</span><span class="n">AdClick</span><span class="o">&gt;</span> <span class="n">sourceContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
                <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Random</span><span class="o">();</span>

                <span class="kt">long</span> <span class="n">initialTimestamp</span><span class="o">,</span> <span class="n">timestampDiff</span><span class="o">;</span>
                <span class="n">initialTimestamp</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">();</span>

                <span class="kt">int</span> <span class="n">lastAdClickId</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

                <span class="k">while</span> <span class="o">(</span><span class="n">keepStreaming</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">10</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">300</span><span class="o">));</span>
                    <span class="n">timestampDiff</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">()</span> <span class="o">-</span> <span class="n">initialTimestamp</span><span class="o">;</span>
                    <span class="n">sourceContext</span><span class="o">.</span><span class="na">collectWithTimestamp</span><span class="o">(</span><span class="k">new</span> <span class="nf">AdClick</span><span class="o">(</span><span class="n">lastAdClickId</span><span class="o">++,</span>
                            <span class="k">new</span> <span class="nf">Random</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="n">adCampaignNumber</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">),</span> <span class="n">timestampDiff</span><span class="o">);</span>
                    <span class="n">sourceContext</span><span class="o">.</span><span class="na">emitWatermark</span><span class="o">(</span><span class="k">new</span> <span class="nf">Watermark</span><span class="o">(</span><span class="n">timestampDiff</span><span class="o">));</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cancel</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">keepStreaming</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="k">return</span> <span class="n">adClickStream</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * RichCoFlatMapFunction used to join AdClicks and AdCampaigns and generate EnrichedAdClicks</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">StreamJoinFunction</span> <span class="kd">extends</span> <span class="n">RichCoFlatMapFunction</span><span class="o">&lt;</span><span class="n">AdClick</span><span class="o">,</span> <span class="n">AdCampaign</span><span class="o">,</span> <span class="n">EnrichedAdClick</span><span class="o">&gt;</span> <span class="o">{</span>

        <span class="cm">/**</span>
<span class="cm">         * AdCampaigns information are kept in the state</span>
<span class="cm">         */</span>
        <span class="kd">private</span> <span class="n">MapState</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">AdCampaign</span><span class="o">&gt;</span> <span class="n">adCampainState</span><span class="o">;</span>


        <span class="cm">/**</span>
<span class="cm">         * Initialize the state used to store AdCampaigns information.</span>
<span class="cm">         *</span>
<span class="cm">         * @param parameters</span>
<span class="cm">         * @throws Exception</span>
<span class="cm">         */</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="o">(</span><span class="n">Configuration</span> <span class="n">parameters</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
            <span class="n">adCampainState</span> <span class="o">=</span> <span class="n">getRuntimeContext</span><span class="o">().</span><span class="na">getMapState</span><span class="o">(</span><span class="k">new</span> <span class="n">MapStateDescriptor</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">AdCampaign</span><span class="o">&gt;(</span>
                    <span class="s">&quot;adCampaigns&quot;</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">AdCampaign</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="cm">/**</span>
<span class="cm">         * Process every element of the first stream: AdClicks.</span>
<span class="cm">         * The function enrich the incoming AdClick with the AdCampaign information present in the state.</span>
<span class="cm">         *</span>
<span class="cm">         * @param adClick   incoming AdClicks</span>
<span class="cm">         * @param collector outcoming EnrichedAdClicks</span>
<span class="cm">         * @throws Exception</span>
<span class="cm">         */</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">flatMap1</span><span class="o">(</span><span class="n">AdClick</span> <span class="n">adClick</span><span class="o">,</span> <span class="n">Collector</span><span class="o">&lt;</span><span class="n">EnrichedAdClick</span><span class="o">&gt;</span> <span class="n">collector</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
            <span class="n">AdCampaign</span> <span class="n">currentAdCampaign</span> <span class="o">=</span> <span class="n">adCampainState</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">adClick</span><span class="o">.</span><span class="na">campaignId</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">campaignName</span> <span class="o">=</span> <span class="o">(</span><span class="n">currentAdCampaign</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="n">currentAdCampaign</span><span class="o">.</span><span class="na">campaignName</span> <span class="o">:</span> <span class="s">&quot;Unknown campaign&quot;</span><span class="o">;</span>

            <span class="n">EnrichedAdClick</span> <span class="n">enrichedAdClick</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">EnrichedAdClick</span><span class="o">(</span><span class="n">adClick</span><span class="o">,</span> <span class="n">campaignName</span><span class="o">);</span>
            <span class="n">collector</span><span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">enrichedAdClick</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="cm">/**</span>
<span class="cm">         * Process every element of the second stream: AdCampaigns.</span>
<span class="cm">         * AdCampaigns information are stored in the State.</span>
<span class="cm">         *</span>
<span class="cm">         * @param adCampaign incoming AdCampaigns</span>
<span class="cm">         * @param collector  outcoming EnrichedAdClicks (unused here, we only update the state)</span>
<span class="cm">         * @throws Exception</span>
<span class="cm">         */</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">flatMap2</span><span class="o">(</span><span class="n">AdCampaign</span> <span class="n">adCampaign</span><span class="o">,</span> <span class="n">Collector</span><span class="o">&lt;</span><span class="n">EnrichedAdClick</span><span class="o">&gt;</span> <span class="n">collector</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
            <span class="n">adCampainState</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">adCampaign</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="n">adCampaign</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">AdCampaign</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="n">campaignName</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">Date</span> <span class="n">updated_at</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">AdCampaign</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nf">AdCampaign</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">updateCampaignVersion</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="cm">/**</span>
<span class="cm">         * Updates the campaignName by increasing the version</span>
<span class="cm">         */</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateCampaignVersion</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">updated_at</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">();</span>
            <span class="k">this</span><span class="o">.</span><span class="na">campaignName</span> <span class="o">=</span> <span class="s">&quot;Campaign &quot;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&quot; v. &quot;</span> <span class="o">+</span> <span class="n">updated_at</span><span class="o">.</span><span class="na">getTime</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="n">StringBuffer</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">StringBuffer</span><span class="o">(</span><span class="s">&quot;AdCampaign{&quot;</span><span class="o">);</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;id=&quot;</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;, campaignName=&#39;&quot;</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">campaignName</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">&#39;\&#39;&#39;</span><span class="o">);</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;, updated_at=&quot;</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">updated_at</span><span class="o">);</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="sc">&#39;}&#39;</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">AdClick</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">Date</span> <span class="n">created_at</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">campaignId</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">AdClick</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nf">AdClick</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="kt">int</span> <span class="n">campaignId</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">created_at</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">();</span>
            <span class="k">this</span><span class="o">.</span><span class="na">campaignId</span> <span class="o">=</span> <span class="n">campaignId</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="n">StringBuffer</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">StringBuffer</span><span class="o">(</span><span class="s">&quot;AdClick{&quot;</span><span class="o">);</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;id=&quot;</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;, created_at=&quot;</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">created_at</span><span class="o">);</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;, campaignId=&quot;</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">campaignId</span><span class="o">);</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="sc">&#39;}&#39;</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Enriched AdClick representation containing also campaign information (only campaignName in this example)</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">EnrichedAdClick</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">AdClick</span> <span class="n">adClick</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="n">campaignName</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">EnrichedAdClick</span><span class="o">(</span><span class="n">AdClick</span> <span class="n">adClick</span><span class="o">,</span> <span class="n">String</span> <span class="n">campaignName</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">adClick</span> <span class="o">=</span> <span class="n">adClick</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">campaignName</span> <span class="o">=</span> <span class="n">campaignName</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="n">StringBuffer</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">StringBuffer</span><span class="o">(</span><span class="s">&quot;EnrichedAdClick{&quot;</span><span class="o">);</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;id=&quot;</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">adClick</span><span class="o">.</span><span class="na">id</span><span class="o">);</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;, created_at=&quot;</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">adClick</span><span class="o">.</span><span class="na">created_at</span><span class="o">);</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;, campaignId=&quot;</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">adClick</span><span class="o">.</span><span class="na">campaignId</span><span class="o">);</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;, campaignName=&quot;</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">campaignName</span><span class="o">);</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="sc">&#39;}&#39;</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>



        </div>
      </div>
    </div><!-- /.container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!-- Disqus -->
    
  </body>
</html>
